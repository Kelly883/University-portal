# Schema & Auth Update Plan

## 1. Update Prisma Schema
*   **Goal**: Align `prisma/schema.prisma` with the user's requested models (`User`, `Course`, `Grade`, `Payment`, `Notification`, `Role`) and relationships.
*   **Details**:
    *   Implement implicit Many-to-Many relation `Enrollments` between `User` and `Course`.
    *   Add `Grade` and `Payment` models.
    *   Retain `Account` model for NextAuth OAuth (Google) support.
    *   Ensure `User` model includes `password` and `role`.

## 2. Database Migration & Seeding
*   **Goal**: Apply schema changes and seed initial data.
*   **Action**:
    *   Run `prisma generate` and `prisma db push`.
    *   Create `prisma/seed.ts` to create Admin, Faculty, and Student users with sample courses and data.
    *   Update `package.json` to include a seed script.

## 3. Configure NextAuth (JWT & Providers)
*   **Goal**: Add Google OAuth and ensure JWT sessions.
*   **Action**:
    *   Update `auth.ts` to include `GoogleProvider`.
    *   Verify `session: { strategy: "jwt" }` (already present).
    *   Ensure `callbacks` in `auth.config.ts` correctly handle the `role`.

## 4. RBAC Middleware
*   **Goal**: strict protection for `/admin`, `/faculty`, `/student`.
*   **Action**:
    *   Review `middleware.ts` and `auth.config.ts` (already implemented, but will double-check against the new "strict" requirement).

## 5. Implementation Verification
*   **Goal**: Ensure the system works as requested.
*   **Action**:
    *   Verify the existence of the App Router auth handler (`src/app/api/auth/[...nextauth]/route.ts`).
    *   Check protected page examples (already created, will refine if schema changes break them).

## Deviation Note
*   The user requested `pages/api/auth/[...nextauth].ts`. Since this project is initialized with **Next.js App Router**, I will use the equivalent `src/app/api/auth/[...nextauth]/route.ts` to maintain architectural consistency.

## Execution Steps
1.  **Schema Update**: Modify `prisma/schema.prisma`.
2.  **Generate & Push**: Update the database.
3.  **Seed Script**: Create and run the seed.
4.  **Auth Update**: Add Google provider to `auth.ts`.
5.  **Verification**: Check middleware and routes.
