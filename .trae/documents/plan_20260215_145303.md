# Deployment Fix Plan: Auth.js Untrusted Host

## 1. Analysis
*   **Error**: `[auth][error] UntrustedHost: Host must be trusted.`
*   **Context**: NextAuth.js (v5 beta) requires explicitly trusting the host when running behind a proxy or on a platform like Railway where the internal URL might differ from the public one.
*   **Affected URLs**:
    *   `http://healthcheck.railway.app` (Internal Railway health check)
    *   `https://university-portal-production-ee9d.up.railway.app` (Your public app URL)

## 2. Solution Strategy
We need to tell NextAuth to trust these hosts. There are two main ways to do this:

### Option A: Environment Variable (Recommended for Platform)
Set `AUTH_TRUST_HOST` to `true` in your Railway environment variables. This tells Auth.js to trust the host header provided by the platform (which is usually correct on Vercel/Railway).

### Option B: Code Configuration (If Env Var fails)
Explicitly configure `trustHost: true` in the `auth.config.ts` or `auth.ts` file.

## 3. Implementation Plan
Since I cannot set your Railway environment variables directly, I will apply the code-level fix which is robust and ensures the app works immediately upon redeployment.

1.  **Modify `auth.ts`**: Add `trustHost: true` to the `NextAuth` configuration object.
2.  **Modify `auth.config.ts`**: (Optional) Ensure consistent configuration if used elsewhere, but `auth.ts` is the main entry point for the App Router.

## 4. Execution Steps
1.  **Update `auth.ts`**: Add the `trustHost` property.
2.  **Commit & Push**: Trigger a new deployment.

*Self-Correction*: I should also advise you to verify that `NEXTAUTH_URL` is set correctly in Railway, but `trustHost: true` usually overrides the need for strict matching in serverless/container environments.

